%function [Y] = ybus(linedata) %declaring function[Y] that takes as input linedata and outputs Y-matrix.
linedata= [ 1   2 0.00350  0.04110 0.69870 0.0000 0   0    0    0;
   1  39 0.00100  0.02500 0.75000 0.0000 0   0    0    0;
   2   3 0.00130  0.01510 0.25720 0.0000 0   0    0    0;
   2  25 0.00700  0.00860 0.14600 0.0000 0   0    0    0;
   2  30 0.00000  0.01810 0.00000 1.0250 0   0    0    0;
   3   4 0.00130  0.02130 0.22140 0.0000 0   0    0    0;
   3  18 0.00110  0.01330 0.21380 0.0000 0   0    0    0;
   4   5 0.00080  0.01280 0.13420 0.0000 0   0    0    0;
   4  14 0.00080  0.01290 0.13820 0.0000 0   0    0    0;
   5   8 0.00080  0.01120 0.14760 0.0000 0   0    0    0;
   6   5 0.00020  0.00260 0.04340 0.0000 0   0    0    0;
   6   7 0.00060  0.00920 0.11300 0.0000 0   0    0    0;
   6  11 0.00070  0.00820 0.13890 0.0000 0   0    0    0;
   7   8 0.00040  0.00460 0.07800 0.0000 0   0    0    0;
   8   9 0.00230  0.03630 0.38040 0.0000 0   0    0    0;
   9  39 0.00100  0.02500 1.20000 0.0000 0   0    0    0;
  10  11 0.00040  0.00430 0.07290 0.0000 0   0    0    0;
  10  13 0.00040  0.00430 0.07290 0.0000 0   0    0    0;
  10  32 0.00000  0.02000 0.00000 1.0700 0   0    0    0;
  12  11 0.00160  0.04350 0.00000 1.0060 0   0    0    0;
  12  13 0.00160  0.04350 0.00000 1.0060 0   0    0    0;
  13  14 0.00090  0.01010 0.17230 0.0000 0   0    0    0;
  14  15 0.00180  0.02170 0.36600 0.0000 0   0    0    0;
  15  16 0.00090  0.00940 0.17100 0.0000 0   0    0    0;
  16  17 0.00070  0.00890 0.13420 0.0000 0   0    0    0;
  16  19 0.00160  0.01950 0.30400 0.0000 0   0    0    0;
  16  21 0.00080  0.01350 0.25480 0.0000 0   0    0    0;
  16  24 0.00030  0.00590 0.06800 0.0000 0   0    0    0;
  17  18 0.00070  0.00820 0.13190 0.0000 0   0    0    0;
  17  27 0.00130  0.01730 0.32160 0.0000 0   0    0    0;
  19  33 0.00070  0.01420 0.00000 1.0700 0   0    0    0;
  19  20 0.00070  0.01380 0.00000 1.0600 0   0    0    0;
  20  34 0.00090  0.01800 0.00000 1.0090 0   0    0    0;
  21  22 0.00080  0.01400 0.25650 0.0000 0   0    0    0;
  22  23 0.00060  0.00960 0.18460 0.0000 0   0    0    0;
  22  35 0.00000  0.01430 0.00000 1.0250 0   0    0    0;
  23  24 0.00220  0.03500 0.36100 0.0000 0   0    0    0;
  23  36 0.00050  0.02720 0.00000 1.0000 0   0    0    0;
  25  26 0.00320  0.03230 0.51300 0.0000 0   0    0    0;
  25  37 0.00060  0.02320 0.00000 1.0250 0   0    0    0;
  26  27 0.00140  0.01470 0.23960 0.0000 0   0    0    0;
  26  28 0.00430  0.04740 0.78020 0.0000 0   0    0    0;
  26  29 0.00570  0.06250 1.02900 0.0000 0   0    0    0;
  28  29 0.00140  0.01510 0.24900 0.0000 0   0    0    0;
  29  38 0.00080  0.01560 0.00000 1.0250 0   0    0    0;
  31   6 0.00000  0.02500 0.00000 1.0000 0  1.2  0.8  0.05;];

nl = linedata (:,1); % extracting column 1 from the linedata file. nl is linefrom bus 
nr = linedata (:,2); % extracting column 2 from the linedata file.nl is line to bus
R = linedata (:,3); %extrac ting the resistance in column 3 from the linedata file.
X = linedata (:,4); %xtracting the line reactance from column 4 
B = linedata(:,5); %extracting half of the total line susceptance from column 8 OF LINEDATA FILE 
nline = length (linedata (:,1)); %declaring the total # of lines 
nbus = max (max (nl), max (nr)); %defining the toal no of nodes
Z = R +j*X; % declaring the impedance
y = ones (nline,1)./Z ; Y= zeros (nbus,nbus);
for n = 1:nbus %defining a for loop to find the diagonal elements of Y-matrix.
for k = 1:nline
if nl (k) == n| nr (k) == n
Y (n,n) = Y (n,n) + y(k)-B(k);
else, end
end
end
for k = 1:nline %defining a loopto find the off-diagonal elements of Y-matrix
Y (nl(k), nr(k))=Y(nl(k),nr(k))-y(k);
Y(nr(k),nl(k))=Y(nl(k),nr(k));
end
Y